<div class="slide">
    <h1>Real Example: Robot/Drone Heading Control</h1>
    
    <div class="problem-setup">
        <h3>ğŸ¤– The Scenario</h3>
        <p>PID controller needs to turn robot from 350Â° to 10Â°</p>
    </div>
    
    <div class="visual-comparison">
        <div class="approach bad-approach">
            <h4>âŒ Naive PID Error</h4>
            <svg width="500" height="500" viewBox="0 0 250 250">
                <circle cx="125" cy="125" r="100" fill="none" stroke="#333" stroke-width="2"/>
                
                <!-- Current heading: 350Â° -->
                <line x1="125" y1="125" x2="115" y2="25" stroke="#2196F3" stroke-width="4"/>
                <circle cx="115" cy="25" r="6" fill="#2196F3"/>
                <text x="75" y="15" font-size="12" fill="#FFC107">Current: 350Â°</text>
                
                <!-- Target heading: 10Â° -->
                <line x1="125" y1="125" x2="135" y2="25" stroke="#4CAF50" stroke-width="4"/>
                <circle cx="135" cy="25" r="6" fill="#4CAF50"/>
                <text x="175" y="15" font-size="12" fill="#FFC107">Target: 10Â°</text>
                
                <!-- Wrong rotation path -->
                <path d="M 115 25 A 100 100 0 1 1 135 25" fill="none" stroke="#FF5722" stroke-width="3" stroke-dasharray="5,5"/>
                <text x="125" y="200" text-anchor="middle" font-size="14" fill="#FF5722" font-weight="bold">
                    Error: -340Â°
                </text>
                <text x="125" y="220" text-anchor="middle" font-size="12" fill="#FF5722">
                    Spins backward!
                </text>
            </svg>
            
            <pre><code>error = target - current
error = 10 - 350 = -340Â°
# Robot spins almost full circle
# the wrong way!</code></pre>
        </div>
        
        <div class="approach good-approach">
            <h4>âœ… Embedded Solution</h4>
            <svg width="500" height="500" viewBox="0 0 250 250">
                <circle cx="125" cy="125" r="100" fill="none" stroke="#333" stroke-width="2"/>
                
                <!-- Current heading: 350Â° -->
                <line x1="125" y1="125" x2="115" y2="25" stroke="#2196F3" stroke-width="4"/>
                <circle cx="115" cy="25" r="6" fill="#2196F3"/>
                <text x="75" y="15" font-size="12" fill="#FFC107">Current: 350Â°</text>
                
                <!-- Target heading: 10Â° -->
                <line x1="125" y1="125" x2="135" y2="25" stroke="#4CAF50" stroke-width="4"/>
                <circle cx="135" cy="25" r="6" fill="#4CAF50"/>
                <text x="175" y="15" font-size="12" fill="#FFC107">Target: 10Â°</text>
                
                <!-- Correct rotation path -->
                <path d="M 115 25 A 100 100 0 0 1 135 25" fill="none" stroke="#4CAF50" stroke-width="3"/>
                <text x="125" y="200" text-anchor="middle" font-size="14" fill="#4CAF50" font-weight="bold">
                    Error: +20Â°
                </text>
                <text x="125" y="220" text-anchor="middle" font-size="12" fill="#4CAF50">
                    Efficient turn!
                </text>
            </svg>
            
            <pre><code>def heading_error(current, target):
    c_vec = [cos(current), sin(current)]
    t_vec = [cos(target), sin(target)]
    return atan2(cross(c_vec, t_vec), 
                 dot(c_vec, t_vec))
# Returns: +20Â° (shortest path!)</code></pre>
        </div>
    </div>
    
    <div class="implementation">
        <h3>Complete PID Controller Fix</h3>
        <pre><code class="language-python">class HeadingController:
    def __init__(self, kp=1.0, ki=0.1, kd=0.05):
        self.kp, self.ki, self.kd = kp, ki, kd
        self.integral = 0
        self.last_error = 0
        
    def compute_control(self, current_heading, target_heading, dt):
        # Embed both headings as vectors
        current_vec = np.array([np.cos(current_heading), np.sin(current_heading)])
        target_vec = np.array([np.cos(target_heading), np.sin(target_heading)])
        
        # Compute signed angle error (always shortest path)
        error = np.arctan2(
            current_vec[0] * target_vec[1] - current_vec[1] * target_vec[0],
            current_vec[0] * target_vec[0] + current_vec[1] * target_vec[1]
        )
        
        # Standard PID computation (now with correct error!)
        self.integral += error * dt
        derivative = (error - self.last_error) / dt
        
        control = self.kp * error + self.ki * self.integral + self.kd * derivative
        self.last_error = error
        
        return control  # Angular velocity command</code></pre>
    </div>
    
    <div class="impact-note">
        <p>ğŸ’° <strong>Real Impact:</strong> Shipping routes crossing the Pacific get drawn spanning ~359Â° longitude instead of the short ~20 nautical mile path due to antimeridian wraparound bugs in mapping SDKs</p>
    </div>
</div>

